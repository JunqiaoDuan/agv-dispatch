# 地图验证方案

## 背景

地图工作室(MapStudio)页面右上角原有保存按钮无实际功能，现改为"验证"按钮，用于验证地图配置是否符合 AGV 调度要求。

由于 AGV 调度中方向信息在动态规划中非常重要，验证规则需重点关注有向图的连通性问题。

## 功能入口

- 页面：地图工作室 `/map-studio/{mapId}`
- 位置：右上角工具栏
- 按钮：验证（原保存按钮）

## 验证规则

### 错误级别（必须修复）

| 规则 | 说明 |
|------|------|
| 无节点 | 地图没有任何节点 |
| 无边 | 地图没有任何边 |
| 孤立节点 | 节点没有任何边连接（完全孤立） |
| 自环边 | 边的起点与终点相同 |
| 重复边 | 存在多条相同起点+终点的边 |

### 警告级别（建议修复）

| 规则 | 说明 |
|------|------|
| 死胡同-无出口 | 节点只有入边，没有出边（AGV 进去出不来） |
| 死胡同-无入口 | 节点只有出边，没有入边（AGV 无法到达） |
| 不可达节点 | 存在从某些节点出发无法到达的节点（有向图可达性） |
| 无法返回节点 | 存在去了之后无法返回起点的节点 |

## 验证结果展示

验证完成后以弹窗或面板形式展示结果，包含三种状态：

### 验证通过

```
✅ 验证通过

统计信息：
- 节点数量: 15 个
- 边数量: 22 条
- 连通性: 良好
```

### 验证通过（有警告）

```
⚠️ 验证通过，但存在以下警告：

警告列表：
- 节点 N003 是死胡同（无出边）
- 节点 N007 从 N001 不可达

统计信息：
- 节点数量: 15 个
- 边数量: 22 条
```

### 验证失败

```
❌ 验证失败，请修复以下错误：

错误列表：
- 存在孤立节点: N005
- 边 E003 是自环边

警告列表：
- 节点 N003 是死胡同（无出边）

统计信息：
- 节点数量: 15 个
- 边数量: 22 条
```

## 实现要点

1. 验证逻辑在前端执行，基于已加载的节点和边数据
2. 连通性检查使用有向图的 DFS/BFS 算法
3. 验证结果支持点击跳转到对应节点/边（可选）

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgvDispatch.Mobile.ViewModels"
             xmlns:dto="using:AgvDispatch.Shared.DTOs.Agvs"
             xmlns:enums="using:AgvDispatch.Shared.Enums"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="360" d:DesignHeight="800"
             x:Class="AgvDispatch.Mobile.Views.AgvListView"
             x:DataType="vm:AgvListViewModel">

    <Grid RowDefinitions="Auto,Auto,*" Margin="16">
        <!-- 标题栏 -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,20">
            <TextBlock Text="系统概览"
                       FontSize="24"
                       FontWeight="SemiBold"
                       Foreground="#212121"/>
        </StackPanel>

        <!-- 统计卡片 - 响应式布局 -->
        <WrapPanel Grid.Row="1" Margin="0,0,0,20" Orientation="Horizontal">
            <!-- 小车总数 -->
            <Border Background="White"
                    CornerRadius="12"
                    BoxShadow="0 2 8 0 #10000000"
                    Padding="12"
                    Width="164"
                    Margin="0,0,8,8">
                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="M19,2H5C3.89,2 3,2.89 3,4V7C3,8.11 3.89,9 5,9H19C20.11,9 21,8.11 21,7V4C21,2.89 20.11,2 19,2M19,16H5C3.89,16 3,16.89 3,18V21C3,22.11 3.89,23 5,23H19C20.11,23 21,22.11 21,21V18C21,16.89 20.11,16 19,16M11,11V13H13V11H11M3,11V13H9V11H3M15,11V13H21V11H15Z"
                                  Foreground="{StaticResource PrimaryBrush}"
                                  Width="24" Height="24"/>
                    </StackPanel>
                    <TextBlock Text="小车总数" FontSize="12" Foreground="#757575"/>
                    <TextBlock Text="{Binding TotalAgvs}" FontSize="28" FontWeight="Bold" Foreground="#212121"/>
                </StackPanel>
            </Border>

            <!-- 在线小车 -->
            <Border Background="White"
                    CornerRadius="12"
                    BoxShadow="0 2 8 0 #10000000"
                    Padding="12"
                    Width="164"
                    Margin="0,0,8,8">
                <StackPanel Spacing="8">
                    <PathIcon Data="M12,21L15.6,16.2C14.6,15.45 13.35,15 12,15C10.65,15 9.4,15.45 8.4,16.2L12,21M12,3C7.95,3 4.21,4.34 1.2,6.6L3,9C5.5,7.12 8.62,6 12,6C15.38,6 18.5,7.12 21,9L22.8,6.6C19.79,4.34 16.05,3 12,3M12,9C9.3,9 6.81,9.89 4.8,11.4L6.6,13.8C8.1,12.67 9.97,12 12,12C14.03,12 15.9,12.67 17.4,13.8L19.2,11.4C17.19,9.89 14.7,9 12,9Z"
                              Foreground="{StaticResource SuccessBrush}"
                              Width="24" Height="24"/>
                    <TextBlock Text="在线小车" FontSize="12" Foreground="#757575"/>
                    <TextBlock Text="{Binding OnlineAgvs}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                </StackPanel>
            </Border>

            <!-- 运行中 -->
            <Border Background="White"
                    CornerRadius="12"
                    BoxShadow="0 2 8 0 #10000000"
                    Padding="12"
                    Width="164"
                    Margin="0,0,8,8">
                <StackPanel Spacing="8">
                    <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z"
                              Foreground="{StaticResource PrimaryBrush}"
                              Width="24" Height="24"/>
                    <TextBlock Text="运行中" FontSize="12" Foreground="#757575"/>
                    <TextBlock Text="{Binding RunningAgvs}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                </StackPanel>
            </Border>

            <!-- 故障小车 -->
            <Border Background="White"
                    CornerRadius="12"
                    BoxShadow="0 2 8 0 #10000000"
                    Padding="12"
                    Width="164"
                    Margin="0,0,8,8">
                <StackPanel Spacing="8">
                    <PathIcon Data="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                              Foreground="{StaticResource ErrorBrush}"
                              Width="24" Height="24"/>
                    <TextBlock Text="故障小车" FontSize="12" Foreground="#757575"/>
                    <TextBlock Text="{Binding ErrorAgvs}" FontSize="28" FontWeight="Bold" Foreground="#212121"/>
                </StackPanel>
            </Border>
        </WrapPanel>

        <!-- 小车列表 -->
        <Border Grid.Row="2" Background="White"
                CornerRadius="12"
                BoxShadow="0 2 8 0 #10000000"
                Padding="20">
            <Grid RowDefinitions="Auto,Auto,*">
                <!-- 列表标题 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Margin="0,0,0,16">
                    <TextBlock Text="小车状态"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="#212121"
                               VerticalAlignment="Center"/>
                    <Button Command="{Binding LoadDataCommand}"
                            Content="刷新"
                            FontSize="14"
                            Height="40"
                            Padding="16,8"
                            CornerRadius="6"
                            Background="{StaticResource PrimaryBrush}"
                            Foreground="White">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{StaticResource SecondaryBrush}"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>

                <!-- 加载指示器 -->
                <ProgressBar Grid.Row="1" IsIndeterminate="True"
                             IsVisible="{Binding IsLoading}"
                             Foreground="{StaticResource PrimaryBrush}"
                             Margin="0,0,0,16"/>

                <!-- 错误信息 -->
                <TextBlock Grid.Row="1" Text="{Binding ErrorMessage}"
                           Foreground="{StaticResource ErrorBrush}"
                           FontSize="14"
                           TextWrapping="Wrap"
                           IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           Margin="0,0,0,16"/>

                <!-- 列表内容 -->
                <ScrollViewer Grid.Row="2">
                    <ItemsControl ItemsSource="{Binding AgvList}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="dto:AgvListItemDto">
                                <Border Background="#F5F5F5"
                                        CornerRadius="8"
                                        Padding="16"
                                        MinHeight="80"
                                        Margin="0,0,0,12">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- 小车图标 -->
                                        <Border Grid.Column="0"
                                                Width="48" Height="48"
                                                Background="{StaticResource PrimaryBrush}"
                                                CornerRadius="24"
                                                Margin="0,0,16,0">
                                            <PathIcon Data="M19,2H5C3.89,2 3,2.89 3,4V7C3,8.11 3.89,9 5,9H19C20.11,9 21,8.11 21,7V4C21,2.89 20.11,2 19,2M19,16H5C3.89,16 3,16.89 3,18V21C3,22.11 3.89,23 5,23H19C20.11,23 21,22.11 21,21V18C21,16.89 20.11,16 19,16M11,11V13H13V11H11M3,11V13H9V11H3M15,11V13H21V11H15Z"
                                                      Foreground="White"
                                                      Width="24" Height="24"/>
                                        </Border>

                                        <!-- 小车信息 -->
                                        <StackPanel Grid.Column="1" Spacing="4" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding AgvCode}"
                                                           FontSize="16"
                                                           FontWeight="SemiBold"
                                                           Foreground="#212121"/>
                                                <TextBlock Text="{Binding DisplayName}"
                                                           FontSize="14"
                                                           Foreground="#757575"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="16">
                                                <TextBlock Text="{Binding AgvStatus}"
                                                           FontSize="13"
                                                           Foreground="#424242"/>
                                                <TextBlock FontSize="13" Foreground="#757575">
                                                    <Run Text="位置: ("/>
                                                    <Run Text="{Binding PositionX, StringFormat='{}{0:F0}'}"/>
                                                    <Run Text=", "/>
                                                    <Run Text="{Binding PositionY, StringFormat='{}{0:F0}'}"/>
                                                    <Run Text=")"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- 电量显示 -->
                                        <StackPanel Grid.Column="2" Spacing="4" VerticalAlignment="Center" MinWidth="80">
                                            <TextBlock Text="{Binding Battery, StringFormat='{}{0}%'}"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       HorizontalAlignment="Right"/>
                                            <ProgressBar Value="{Binding Battery}"
                                                         Minimum="0"
                                                         Maximum="100"
                                                         Height="8"
                                                         CornerRadius="4"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>

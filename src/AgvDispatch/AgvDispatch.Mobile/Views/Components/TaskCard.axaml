<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:dto="using:AgvDispatch.Shared.DTOs.Tasks"
             x:Class="AgvDispatch.Mobile.Views.Components.TaskCard"
             x:DataType="dto:TaskListItemDto">

    <Border Background="White"
            CornerRadius="12"
            BoxShadow="0 2 8 0 #10000000"
            Padding="16"
            Margin="0,0,0,12"
            Tapped="OnCardTapped"
            Cursor="Hand"
            PointerEntered="OnPointerEntered"
            PointerExited="OnPointerExited">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto">
            <!-- 第一行：任务类型 + 状态 -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                <Border Background="{StaticResource InfoBrush}"
                        CornerRadius="6"
                        Padding="8,4">
                    <TextBlock Text="{Binding TaskType, Converter={StaticResource TaskJobTypeToTextConverter}}"
                               FontSize="13"
                               Foreground="White"
                               FontWeight="SemiBold"/>
                </Border>

                <Border Background="{Binding TaskStatus, Converter={StaticResource TaskJobStatusToBrushConverter}}"
                        CornerRadius="6"
                        Padding="8,4">
                    <TextBlock Text="{Binding TaskStatus}"
                               FontSize="13"
                               Foreground="White"
                               FontWeight="SemiBold"/>
                </Border>
            </StackPanel>

            <!-- 第二行：AGV编号 -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="4" Margin="0,0,0,8">
                <PathIcon Data="M19,2H5C3.89,2 3,2.89 3,4V7C3,8.11 3.89,9 5,9H19C20.11,9 21,8.11 21,7V4C21,2.89 20.11,2 19,2M19,16H5C3.89,16 3,16.89 3,18V21C3,22.11 3.89,23 5,23H19C20.11,23 21,22.11 21,21V18C21,16.89 20.11,16 19,16M11,11V13H13V11H11M3,11V13H9V11H3M15,11V13H21V11H15Z"
                          Width="16" Height="16"
                          Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="小车:" FontSize="13" Foreground="#757575"/>
                <TextBlock Text="{Binding AssignedAgvCode}" FontSize="13" Foreground="#212121" FontWeight="SemiBold"/>
            </StackPanel>

            <!-- 第三行：起点 → 终点 -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="6" Margin="0,0,0,8">
                <Border Background="#E3F2FD"
                        CornerRadius="6"
                        Padding="6,4">
                    <TextBlock Text="{Binding StartStationCode}" FontSize="12" Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold"/>
                </Border>

                <PathIcon Data="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"
                          Width="16" Height="16"
                          Foreground="#9E9E9E"
                          VerticalAlignment="Center"/>

                <Border Background="#E8F5E9"
                        CornerRadius="6"
                        Padding="6,4">
                    <TextBlock Text="{Binding EndStationCode}" FontSize="12" Foreground="{StaticResource SuccessBrush}" FontWeight="SemiBold"/>
                </Border>
            </StackPanel>

            <!-- 第四行：进度条 -->
            <Grid Grid.Row="3" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
                <ProgressBar Grid.Column="0"
                             Value="{Binding ProgressPercentage}"
                             Maximum="100"
                             Height="8"
                             CornerRadius="4"
                             Foreground="{StaticResource SuccessBrush}"
                             Background="#E0E0E0"
                             VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1"
                           FontSize="12"
                           Foreground="#616161"
                           FontWeight="SemiBold"
                           Margin="8,0,0,0"
                           VerticalAlignment="Center">
                    <Run Text="{Binding ProgressPercentage, StringFormat='{}{0:F0}'}"/>
                    <Run Text="%"/>
                </TextBlock>
            </Grid>

            <!-- 第五行：时间信息 -->
            <WrapPanel Grid.Row="4" Orientation="Horizontal">
                <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,0,12,0">
                    <PathIcon Data="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
                              Width="12" Height="12"
                              Foreground="#9E9E9E"/>
                    <TextBlock FontSize="11" Foreground="#757575">
                        <Run Text="创建:"/>
                        <Run Text="{Binding CreationDate, StringFormat='{}{0:HH:mm}'}"/>
                    </TextBlock>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,0,12,0"
                            IsVisible="{Binding StartedAt, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <PathIcon Data="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
                              Width="12" Height="12"
                              Foreground="#4CAF50"/>
                    <TextBlock FontSize="11" Foreground="#757575">
                        <Run Text="开始:"/>
                        <Run Text="{Binding StartedAt, StringFormat='{}{0:HH:mm}'}"/>
                    </TextBlock>
                </StackPanel>
            </WrapPanel>
        </Grid>
    </Border>
</UserControl>
